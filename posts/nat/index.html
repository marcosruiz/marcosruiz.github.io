<!DOCTYPE html><html lang="es" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="NAT estático, NAT dinámico y PAT" /><meta property="og:locale" content="es" /><meta name="description" content="Introducción" /><meta property="og:description" content="Introducción" /><link rel="canonical" href="https://marcosruiz.github.io/posts/nat/" /><meta property="og:url" content="https://marcosruiz.github.io/posts/nat/" /><meta property="og:site_name" content="Marcos Ruiz" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-02-08T13:30:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="NAT estático, NAT dinámico y PAT" /><meta name="twitter:site" content="@whataweekhuh" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-05-25T14:43:58+02:00","datePublished":"2022-02-08T13:30:00+01:00","description":"Introducción","headline":"NAT estático, NAT dinámico y PAT","mainEntityOfPage":{"@type":"WebPage","@id":"https://marcosruiz.github.io/posts/nat/"},"url":"https://marcosruiz.github.io/posts/nat/"}</script><title>NAT estático, NAT dinámico y PAT | Marcos Ruiz</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Marcos Ruiz"><meta name="application-name" content="Marcos Ruiz"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" https://avatars.githubusercontent.com/u/7647613?v=4 " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Marcos Ruiz</a></div><div class="site-subtitle font-italic">Trabaja duro para ser vago</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORÍAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>ETIQUETAS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVOS</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>SOBRE MÍ</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/marcosruiz" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['profesor.mruizg','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Inicio </a> </span> <span>NAT estático, NAT dinámico y PAT</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Artículo</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>NAT estático, NAT dinámico y PAT</h1><div class="post-meta text-muted"><div> <em> <a href="https://github.com/marcosruiz">Marcos Ruiz</a> </em></div><div class="d-flex"><div> <span> <em class="timeago" data-ts="1644323400" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-02-08 </em> </span> <span> Actualizado <em class="timeago" data-ts="1685018638" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2023-05-25 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2510 palabras"> <em>13 minutos</em> lectura</span></div></div></div><div class="post-content"><h2 class="section" id="introducción">Introducción</h2><p>Antes de nada es recomendable volver a ver este vídeo introductorio:</p><iframe src="https://www.youtube.com/embed/HeZWcZmrQUY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><p>Preguntas sobre el vídeo:</p><ul><li>¿Cómo sabe el router a qué dispositivo de la LAN a la que va el paquete de respuesta?<li>¿El router analiza la dirección MAC para realizar el trabajo del NAT satisfactoriamente?<li>¿Qué es el NAT? ¿En qué dispositivo suele estar?<li>¿Cuál es la IP de la puerta de enlace?<li>¿Cuál es el rango de direcciones IP? ¿Cómo se puede calcular?<li>¿Es lo mismo la puerta enlace que el gateway? ¿Qué le(s) corresponde(n)?<li>¿Por qué existen las IPs privadas? ¿No podrían ser todas públicas y así ahorrarnos el paso de traducción?</ul><p>Y ver también este video:</p><iframe width="560" height="315" src="https://www.youtube.com/embed/YgcBCTfnx6U" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe><h2 class="section" id="características-de-un-nat">Características de un NAT</h2><p>Como sabes, no hay suficientes direcciones IPv4 públicas para asignar una dirección única a cada dispositivo conectado a Internet. Las redes suelen implementarse mediante el uso de direcciones IPv4 privadas, según se definen en RFC 1918. El rango de direcciones incluido en RFC 1918 se incluye en la siguiente tabla. Es muy probable que la computadora que utilizas tenga asignada una dirección privada.</p><div class="table-wrapper"><table><thead><tr><th>Clase<th>Rango de @ privadas<th>Prefijo<th>Nº de redes<tbody><tr><td>Clase A<td>10.0.0.0 a 10.255.255.255<td>10.0.0.0/8<td>1 red<tr><td>Clase B<td>172.16.0.0 a 172.31.255.255<td>172.16.0.0/12<td>16 redes<tr><td>Clase C<td>192.168.0.0 a 192.168.255.255<td>192.168.0.0/16<td>256 redes</table></div><p class="question">¿Cuál es la dirección IP de tu equipo? ¿Es pública o privada?</p><p class="question">¿Por qué el rango de direcciones privadas de Clase B se define del siguiente modo: 172.16.0.0/12?</p><p>Estas direcciones privadas se utilizan dentro de una organización o un sitio para permitir que los dispositivos se comuniquen localmente. Sin embargo, debido a que estas direcciones no identifican a una sola empresa u organización, las direcciones IPv4 privadas no se pueden enrutar a través de Internet. Para permitir que un dispositivo con una dirección IPv4 privada acceda a recursos y dispositivos fuera de la red local, primero se debe traducir la dirección privada a una dirección pública.</p><p>NAT proporciona la traducción de direcciones privadas a direcciones públicas, como se muestra en la figura. Esto permite que un dispositivo con una dirección IPv4 privada acceda a recursos fuera de su red privada, como los que se encuentran en Internet. NAT, combinado con direcciones IPv4 privadas, ha sido el método principal para preservar las direcciones IPv4 públicas. Se puede compartir una única dirección IPv4 pública entre cientos o incluso miles de dispositivos, cada uno configurado con una dirección IPv4 privada exclusiva.</p><p><img data-src="/assets/img/nat/Traduccion-de-direcciones-privadas-a-publicas.png" alt="Traducción de direcciones privadas a públicas" data-proofer-ignore> <em>Traducción de direcciones privadas a públicas</em></p><details class="card mb-2"> <summary class="card-header question">¿Quién es el culpable de que sigamos usando IPv4?</summary><div class="card-body"><p>Sin NAT, el agotamiento del espacio de direcciones IPv4 habría ocurrido mucho antes del año 2000. Sin embargo, NAT tiene limitaciones y desventajas, que se explorarán más adelante en este módulo. La solución al agotamiento del espacio de direcciones IPv4 y a las limitaciones de NAT es la transición final a IPv6.</p></div></details><h2 class="section" id="qué-es-un-nat">¿Qué es un NAT?</h2><p>NAT tiene muchos usos, pero el principal es conservar las direcciones IPv4 públicas. Esto se logra al permitir que las redes utilicen direcciones IPv4 privadas internamente y al proporcionar la traducción a una dirección pública solo cuando sea necesario. NAT tiene el beneficio percibido de agregar un grado de privacidad y seguridad a una red, ya que oculta las direcciones IPv4 internas de redes externas.</p><p>Los routers con NAT habilitada se pueden configurar con una o más direcciones IPv4 públicas válidas. Estas direcciones públicas se conocen como “NAT pool”. Cuando un dispositivo interno envía tráfico fuera de la red, el router con NAT habilitada traduce la dirección IPv4 interna del dispositivo a una dirección pública del conjunto de NAT. Para los dispositivos externos, todo el tráfico entrante y saliente de la red parece tener una dirección IPv4 pública del pool de direcciones proporcionado.</p><h3 class="subsection" id="cómo-funciona-un-nat">¿Cómo funciona un NAT?</h3><p>La traducción de estas direcciones de red (NAT) es un mecanismo que permite a varias máquinas de una LAN con direcciones privadas para que puedan acceder a una red externa, por ejemplo Internet, con una IP pública. Esta traducción de direcciones también es llamada <strong>enmascaramiento IP</strong>.</p><p class="question">¿Es lo mismo NAT que enmascaramiento IP?</p><p>Para que sea posible hacer esa traducción de direcciones ha de haber un dispositivo que se encargue de hacer esa traducción en ambos sentidos que generalmente es un router.</p><p><img data-src="/assets/img/nat/Como-Funciona-NAT.gif" alt="Funcionamiento de un NAT" data-proofer-ignore> <em>Funcionamiento de un NAT</em></p><h3 class="subsection" id="terminología-nat">Terminología NAT</h3><p>Cuando se usa NAT, las direcciones IPv4 tienen diferentes designaciones en función de si están en la red privada o en la red pública (internet), y si el tráfico es entrante o saliente.</p><p>NAT incluye cuatro tipos de direcciones:</p><ul><li>Dirección local interna.<li>Dirección global interna.<li>Dirección local externa.<li>Dirección global externa.</ul><p>Desde el punto de vista del ordenador que envía el mensaje detrás de un router:</p><ul><li>Dirección local (privada) interna (origen). Por ejemplo: 192.168.1.10<li>Dirección global (pública) interna (origen). Por ejemplo: la @ IP pública del IES Tiempos Modernos: 40.77.167.227.<li>Dirección local (privada) externa (destino). Por ejemplo: La @ IP de Google: 142.250.184.163.<li>Dirección global (pública) externa (destino). Por ejemplo: La @ IP de Google: 142.250.184.163.</ul><p>Al determinar qué tipo de dirección se utiliza, es importante recordar que la terminología de NAT siempre se aplica desde la perspectiva del dispositivo con la dirección traducida:</p><ul><li><strong>Dirección interna</strong>: La dirección del dispositivo que NAT está traduciendo. Se puede ver como la dirección origen.<li><strong>Dirección externa</strong>: La dirección del dispositivo de destino. Se puede ver como la dirección destino.</ul><p>NAT también usa los conceptos de local o global con relación a las direcciones:</p><ul><li><strong>Dirección local</strong>: Una dirección local es cualquier dirección que aparece en la parte interna de la red. Se puede ver como la dirección privada.<li><strong>Dirección global</strong>: Una dirección global es cualquier dirección que aparece en la parte externa de la red. Se puede ver como la dirección pública.</ul><p>Los términos “interna” y “externa” se combinan con los términos “global” y “local” para hacer referencia a direcciones específicas. El router NAT, R2 en la figura, es el punto de demarcación entre las redes internas y externas. R2 está configurado con un pool de direcciones públicas para asignar a los hosts internos. Consulta la tabla de red y NAT de la figura para obtener la siguiente explicación de cada uno de los tipos de direcciones NAT.</p><p><img data-src="/assets/img/nat/Terminologia-de-NAT.png" alt="Funcionamiento de un NAT" data-proofer-ignore> <em>Terminología de NAT</em></p><p>PC1 tiene una dirección local interna de 192.168.10.10. Desde la perspectiva de la PC1, el servidor web tiene la dirección externa 209.165.201.1. Cuando se envían los paquetes de la PC1 a la dirección global del servidor web, la dirección local interna de la PC1 se traduce al 209.165.200.226 (dirección global interna). La dirección del dispositivo externo generalmente no se traduce porque esa dirección suele ser una dirección IPv4 pública.</p><p>Observa que la PC1 tiene distintas direcciones locales y globales, mientras que el servidor web tiene la misma dirección IPv4 pública en ambos casos. Desde la perspectiva del servidor web, el tráfico que se origina en la PC1 parece provenir de 209.165.200.226, la dirección global interna.</p><p class="question">¿Qué es un NAT?</p><h2 class="section" id="tipos-de-nat">Tipos de NAT</h2><p>Existen 3 tipos de NAT:</p><ul><li>NAT estático (de correlación)<li>NAT dinámico (ocultación)<li>PAT (con correlación de puerto)</ul><iframe width="560" height="315" src="https://www.youtube.com/embed/RixJRiG2J9M" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe><h3 class="subsection" id="nat-estático">NAT estático</h3><p>El NAT estático consiste en una asignación uno a uno entre direcciones locales y globales. Estas asignaciones son configuradas por el administrador de red y se mantienen constantes.</p><p><img data-src="/assets/img/nat/NAT-Estatico.png" alt="NAT Estático" data-proofer-ignore> <em>NAT Estático</em></p><p>En la ilustración, el R2 se configuró con las asignaciones estáticas para las direcciones locales internas del Svr1, el PC2 y el PC3. Cuando estos dispositivos envían tráfico a Internet, sus direcciones locales internas se traducen a las direcciones globales internas configuradas. Para redes externas, estos dispositivos parecen tener direcciones IPv4 públicas.</p><p>El NAT estático es particularmente útil para servidores web o dispositivos que deben tener una dirección coherente a la que se pueda acceder desde Internet, como el servidor web de una empresa. También es útil para dispositivos que deben ser accesibles por personal autorizado cuando se encuentra fuera del sitio, pero no por el público en general en Internet. Por ejemplo, un administrador de red de PC4 puede usar SSH para obtener acceso a la dirección global interna de Svr1 (209.165.200.226). R2 traduce esta dirección global interna a la dirección local interna 192.168.10.10 y conecta la sesión a Svr1.</p><p>El NAT estático requiere que haya suficientes direcciones públicas disponibles para satisfacer la cantidad total de sesiones de usuario simultáneas.</p><p class="question">¿Un router con NAT estática convierte a un router en un dispositivo de capa 4?</p><h4 class="subsubsection" id="configurar-nat-estática">Configurar NAT estática</h4><p>Para configurar una NAT estática puedes seguir los pasos del artículo <a href="https://ccnadesdecero.es/nat-estatica/">NAT Estática</a> o seguir los pasos del siguiente vídeo:</p><iframe src="https://www.youtube.com/embed/dV9jK4g1uyw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><h3 class="subsection" id="nat-dinámica">NAT dinámica</h3><p>El NAT dinámico utiliza un pool de direcciones públicas y las asigna según el orden de llegada. Cuando un dispositivo interno solicita acceso a una red externa, el NAT dinámico asigna una dirección IPv4 pública disponible del pool.</p><p><img data-src="/assets/img/nat/NAT-Dinamica.png" alt="NAT Estático" data-proofer-ignore> <em>NAT dinámica</em></p><p>En la figura, el PC3 ha accedido a Internet utilizando la primera dirección disponible en el pool NAT dinámico. Las demás direcciones siguen disponibles para utilizarlas. Al igual que el NAT estático, el NAT dinámico requiere que haya suficientes direcciones públicas disponibles para satisfacer la cantidad total de sesiones de usuario simultáneas.</p><p class="question">¿Cuántos usuarios pueden tener acceso a internet con un pool de 3 direcciones IP?</p><p class="question">¿Cuántos usuarios simultáneos pueden tener acceso a internet con un pool de 3 direcciones IP?</p><p class="question">¿Un router con NAT dinámica convierte a un router en un dispositivo de capa 4?</p><h4 class="subsubsection" id="configurar-nat-dinámica">Configurar NAT dinámica</h4><p>Para configurar una NAT estática puedes seguir los pasos del artículo <a href="https://ccnadesdecero.es/nat-dinamica/">NAT Dinámica</a> o seguir los pasos del siguiente vídeo:</p><iframe src="https://www.youtube.com/embed/rge-SwOx6Dg" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><h3 class="subsection" id="pat">PAT</h3><p>La traducción de la dirección del puerto (PAT, Port Address Translation), también conocida como “NAT con sobrecarga”, asigna varias direcciones IPv4 privadas a una única dirección IPv4 pública o a algunas direcciones. Esto es lo que hacen la mayoría de los routers domésticos. El ISP asigna una dirección al router, sin embargo, varios miembros del hogar pueden acceder simultáneamente a Internet. Esta es la forma más común de NAT tanto para el hogar como para la empresa.</p><p class="question">¿Qué es el ISP?</p><p class="question">¿Qué tipo de NAT usan la mayoría de los routers domésticos?</p><p>Con PAT, se pueden asignar varias direcciones a una o más direcciones, debido a que cada dirección privada también se rastrea con un número de puerto. Cuando un dispositivo inicia una comunicación, genera un valor de puerto de origen TCP o UDP para identificar de forma única la sesión. Cuando el router NAT recibe un paquete del cliente, utiliza su número de puerto de origen para identificar de forma exclusiva la traducción NAT específica.</p><p><img data-src="/assets/img/nat/Proceso-de-PAT.gif" alt="Proceso de PAT" data-proofer-ignore> <em>Proceso de PAT</em></p><details class="card mb-2"> <summary class="card-header">Proceso de PAT paso a paso</summary><div class="card-body"><p><img data-src="/assets/img/nat/Proceso-de-PAT-0.png" alt="Proceso de PAT" data-proofer-ignore> <em>Proceso de PAT: Paso 1</em></p><p><img data-src="/assets/img/nat/Proceso-de-PAT-4.png" alt="Proceso de PAT" data-proofer-ignore> <em>Proceso de PAT: Paso 2</em></p><p><img data-src="/assets/img/nat/Proceso-de-PAT-13.png" alt="Proceso de PAT" data-proofer-ignore> <em>Proceso de PAT: Paso 3</em></p><p><img data-src="/assets/img/nat/Proceso-de-PAT-24.png" alt="Proceso de PAT" data-proofer-ignore> <em>Proceso de PAT: Paso 4</em></p><p><img data-src="/assets/img/nat/Proceso-de-PAT-40.png" alt="Proceso de PAT" data-proofer-ignore> <em>Proceso de PAT: Paso 5</em></p></div></details><p>A medida que el R2 procesa cada paquete, utiliza un número de puerto (1331 y 1555, en este ejemplo) para identificar el dispositivo en el que se originó el paquete. La dirección de origen (SA, source address) es la dirección local interna con el número de puerto asignado TCP / UDP agregado. La dirección de destino (DA, destination address) es la dirección global externa con el número de puerto de servicio agregado. En este ejemplo, el puerto de servicio es 80, que es HTTP.</p><p>Para la dirección de origen, el R2 traduce la dirección local interna a una dirección global interna con el número de puerto agregado. La dirección de destino no cambia, pero ahora se conoce como la dirección IPv4 global externa. Cuando el servidor web responde, se invierte la ruta.</p><details class="card mb-2"> <summary class="card-header question">¿Qué diferencias hay entre un NAT y un PAT?</summary><div class="card-body"><div class="table-wrapper"><table><thead><tr><th>NAT<th>PAT<tbody><tr><td>Mapeo uno a uno entre las direcciones Locales Internas y Globales Internas.<td>Una dirección Interna Global puede ser mapeada a muchas direcciones Locales Internas.<tr><td>Utiliza sólo direcciones IPv4 en el proceso de traducción.<td>Utiliza direcciones IPv4 y números de puertos de origen TCP o UDP en el proceso de traducción.<tr><td>Se requiere una dirección única Global Interna para cada host interno que acceda a la red externa.<td>Una única y exclusiva dirección Global Interna puede ser compartida por muchos hosts internos que acceden a la red exterior.</table></div></div></details><p class="question">¿Es lo mismo PAT que NAT con sobrecarga?</p><p class="question">¿Un router con PAT convierte a un router en un dispositivo de capa 4?</p><h4 class="subsubsection" id="configurar-pat">Configurar PAT</h4><p>Para configurar una NAT estática puedes seguir los pasos del artículo <a href="https://ccnadesdecero.es/configurar-pat/">PAT</a> o seguir los pasos del siguiente vídeo:</p><iframe src="https://www.youtube.com/embed/I6MLqzfy6BI" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><h4 class="subsubsection" id="siguiente-puerto-disponible">Siguiente puerto disponible</h4><p>En el ejemplo anterior, los números de puerto del cliente, 1331 y 1555, no se modificaron en el router con NAT habilitada. Esta no es una situación muy probable, porque existe una gran posibilidad de que estos números de puerto ya se hayan conectado a otras sesiones activas.</p><p>PAT intenta conservar el puerto de origen inicial. Sin embargo, si el puerto de origen original ya está en uso, PAT asigna el primer número de puerto disponible a partir del comienzo del grupo de puertos apropiado 0-511, 512-1023 o 1024-65535.</p><h4 class="subsubsection" id="ejemplo-de-funcionamiento-pat">Ejemplo de funcionamiento PAT</h4><p>Supongamos que tenemos un host, que llamaremos CLIENTE y que tiene por dirección IP 10.1.1.5 y máscara de toda la red 255.0.0.0, que quiere acceder a Internet solicitando páginas a través de su navegador. La conexión a Internet se ha realizado en otro host de la red al que llamaremos ROUTER con dirección IP 10.1.1.1 y que está en la misma red que CLIENTE.</p><p>Cuando el ROUTER realiza una conexión a Internet, su proveedor le proporciona una dirección IP a la interfaz de red WAN por la que se conecta remotamente que es 213.97.2.12.</p><p>Debemos tener en cuenta que los pasos 1 y 4 se producen dentro de una LAN, mientras que los números 2 y 3 proceden de una WAN.</p><p><img data-src="/assets/img/nat/ejemploNat.png" alt="img-description" data-proofer-ignore> <em>Esquema de un ejemplo de utilización de enmascaramiento IP</em></p><p class="question">¿De que tipo es la red del CLIENTE?</p><p class="question">¿Tiene el ROUTER la primera @ disponible de la red?</p><p>El CLIENTE lo configuraremos para que la ruta por defecto apunte a ROUTER.</p><p>Si el navegador en el CLIENTE solicita una página al servidor 225.10.2.150 por el puerto 1345, como el CLIENTE no tiene acceso por red al host 225.10.2.150, mandará el mensaje por la ruta de defecto al ROUTER. Si el ROUTER tiene habilitado el servicio de enmascaramiento, sustituirá la dirección IP del CLIENTE por la suya propia en la interfaz WAN (213.97.2.12) y el número de puerto por otro que tenga libre, haciéndole la petición al servidor web cuya dirección es 225.10.2.150. Cuando el servidor web le conteste, el ROUTER sustituirá la dirección IP WAN suya (213.97.2.12) por la dirección IP propia en su red de área local (10.1.1.1) y se lo mandará a CLIENTE por el puerto por el que este se quedó esperando, en nuestro ejemplo, el 1345. De este modo, CLIENTE ha recibido sus datos transparentemente, es decir, sin enterarse de nada.</p><p><img data-src="/assets/img/nat/ejemploNat2.png" alt="Ejemplo enmascaramiento IP sin cambio de puerto" data-proofer-ignore> <em>Ejemplo enmascaramiento IP sin cambio de puerto</em></p><p><img data-src="/assets/img/nat/ejemploNat3.png" alt="Ejemplo enmascaramiento IP con cambio de puerto" data-proofer-ignore> <em>Ejemplo enmascaramiento IP con cambio de puerto</em></p><h4 class="subsubsection" id="otro-ejemplo-de-funcionamiento-pat">Otro ejemplo de funcionamiento PAT</h4><p><img data-src="/assets/img/nat/dynamic-pat-initial.png" alt="Ejemplo de enmascaramiento IP: Envío" data-proofer-ignore> <em>Ejemplo de enmascaramiento IP: Envío</em></p><p><img data-src="/assets/img/nat/dynamic-pat-return.png" alt="Ejemplo de enmascaramiento IP: Respuesta" data-proofer-ignore> <em>Ejemplo de enmascaramiento IP: Respuesta</em></p><details class="card mb-2"> <summary class="card-header question">¿Por qué los puertos también se traducen aleatoriamente?</summary><div class="card-body"><p><img data-src="/assets/img/nat/dynamic-pat-non-random-src-port-v5.png" alt="Ejemplo de enmascaramiento IP: Conflicto de mismo puerto" data-proofer-ignore> <em>Ejemplo de enmascaramiento IP: Conflicto de mismo puerto</em></p></div></details><p><img data-src="/assets/img/nat/dynamic-pat-failed-inbound-packet.png" alt="Ejemplo de enmascaramiento IP: Fallo de traducción" data-proofer-ignore> <em>Ejemplo de enmascaramiento IP: Fallo de traducción</em></p><h2 id="bibliografía"><span class="mr-2">Bibliografía</span><a href="#bibliografía" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><a href="https://www.ibm.com/docs/es/i/7.2?topic=concepts-network-address-translation">Conversión de direcciones de red (NAT)</a><li><a href="https://ccnadesdecero.es/caracteristicas-nat/">Características de NAT</a><li><a href="https://ccnadesdecero.es/tipos-nat/">Tipos de NAT</a><li><a href="https://ccnadesdecero.es/ventajas-desventajas-nat/">Ventajas y Desventajas de NAT</a><li><a href="https://www.practicalnetworking.net/series/nat/dynamic-pat/">Dynamic PAT</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/sistemas-microinform%C3%A1ticos-y-redes/'>Sistemas Microinformáticos y Redes</a>, <a href='/categories/redes-locales/'>Redes Locales</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/redes-locales/" class="post-tag no-text-decoration" >redes locales</a> <a href="/tags/smr/" class="post-tag no-text-decoration" >smr</a> <a href="/tags/teor%C3%ADa/" class="post-tag no-text-decoration" >teoría</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Este artículo está licenciado bajo <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> por el autor.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=NAT estático, NAT dinámico y PAT - Marcos Ruiz&amp;url=https://marcosruiz.github.io/posts/nat/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=NAT estático, NAT dinámico y PAT - Marcos Ruiz&amp;u=https://marcosruiz.github.io/posts/nat/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://marcosruiz.github.io/posts/nat/&amp;text=NAT estático, NAT dinámico y PAT - Marcos Ruiz" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copiar link" data-title-succeed="Link copiado satisfactoriamente!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recientemente actualizado</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/tutorial-moodle-docker/">Tutorial: Instalar Moodle con Docker</a><li><a href="/posts/tutorial-nextcloud/">Tutorial: Monta tu propio Google Drive con NextCloud</a><li><a href="/posts/guias-estilo/">Guías de estilo</a><li><a href="/posts/callbacks-javascript/">Callbacks en JavaScript</a><li><a href="/posts/propagacion-eventos-javascript/">Propagación de eventos en JavaScript</a></ul></div><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/smr/">smr</a> <a class="post-tag" href="/tags/daw/">daw</a> <a class="post-tag" href="/tags/desarrollo-de-aplicaciones-web/">desarrollo de aplicaciones web</a> <a class="post-tag" href="/tags/teor%C3%ADa/">teoría</a> <a class="post-tag" href="/tags/ciclo-superior/">ciclo superior</a> <a class="post-tag" href="/tags/fp/">fp</a> <a class="post-tag" href="/tags/modulo/">modulo</a> <a class="post-tag" href="/tags/pr%C3%A1ctica/">práctica</a> <a class="post-tag" href="/tags/formaci%C3%B3n-profesional/">formación profesional</a> <a class="post-tag" href="/tags/seguridad-inform%C3%A1tica/">seguridad informática</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Índice</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Otros artículos</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/subredes/"><div class="card-body"> <em class="timeago small" data-ts="1642878000" > 2022-01-22 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>¿Qué son las subredes?</h3><div class="text-muted small"><p> ¿Qué son las subredes? En redes de computadoras, una subred es un rango de direcciones lógicas. Cuando una red se vuelve muy grande, conviene dividirla en subredes, por los siguientes motivos: ...</p></div></div></a></div><div class="card"> <a href="/posts/enrutamiento/"><div class="card-body"> <em class="timeago small" data-ts="1644323400" > 2022-02-08 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Enrutamiento o encaminamiento</h3><div class="text-muted small"><p> ¿Qué es un router? Un router (también llamado enrutador o encaminador) es un equipo que conecta entre sí dos o más redes distintas. La función principal de un router es encaminar elegir el camino...</p></div></div></a></div><div class="card"> <a href="/posts/interconexion-de-equipos-y-redes/"><div class="card-body"> <em class="timeago small" data-ts="1644532200" > 2022-02-10 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Interconexión de equipos y redes</h3><div class="text-muted small"><p> Antes de empezar con este artículo es necesario entender el artículo Direcciones IPv4. Encaminador o enrutador Leer el artículo Enrutamiento o encaminamiento. NAT o enmascaramiento IP Leer el a...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/enrutamiento/" class="btn btn-outline-primary" prompt="Más viejo"><p>Enrutamiento o encaminamiento</p></a> <a href="/posts/despliegue-de-cableado/" class="btn btn-outline-primary" prompt="Más nuevo"><p>Despliegue de cableado</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "marcosruiz/marcosruiz.github.io", "data-repo-id": "R_kgDOGm1dzA", "data-category": "General", "data-category-id": "DIC_kwDOGm1dzM4CAjhb", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "es", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/marcosruiz">Marcos Ruiz</a>. <span data-toggle="tooltip" data-placement="top" title="Excepto donde si indique lo contrario, los artículos de este blog están licenciados bajo Creative Commons Attribution 4.0 International (CC BY 4.0) Licenciado por el autor.">Algunos derechos reservados.</span></p></div><div class="footer-right"><p class="mb-0"> Desarrollado por <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> con el tema <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> .</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/smr/">smr</a> <a class="post-tag" href="/tags/daw/">daw</a> <a class="post-tag" href="/tags/desarrollo-de-aplicaciones-web/">desarrollo de aplicaciones web</a> <a class="post-tag" href="/tags/teor%C3%ADa/">teoría</a> <a class="post-tag" href="/tags/ciclo-superior/">ciclo superior</a> <a class="post-tag" href="/tags/fp/">fp</a> <a class="post-tag" href="/tags/modulo/">modulo</a> <a class="post-tag" href="/tags/pr%C3%A1ctica/">práctica</a> <a class="post-tag" href="/tags/formaci%C3%B3n-profesional/">formación profesional</a> <a class="post-tag" href="/tags/seguridad-inform%C3%A1tica/">seguridad informática</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! Resultado no encontrado.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/es.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-GS5HW4NZ8V"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-GS5HW4NZ8V'); }); </script>
