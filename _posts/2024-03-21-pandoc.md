---
title: "Pandoc"
date: 2024-03-21 9:00:00 +0100
categories: [General]
tags: [pandoc, markdown, pdf, md, eisvogel, plantilla, docker, latex, lua, lualatex, plantilla, jekyll]
img_path: /assets/img/pandoc/
---

## Introducci√≥n

Este art√≠culo pretende ser una gu√≠a para transformar documentos con Pandoc.

## Instalar Eisvogel en Windows

La herramienta que se usa para transformar documentos es Pandoc con la plantilla Eisvogel.

Puedes seguir los pasos del README de <https://github.com/Wandmalfarbe/pandoc-latex-template?tab=readme-ov-file>.

Si ya tienes docker lo √∫nico que tienes que hacer es descargar el contenedor:

```console
docker pull pandoc/extra
```

Una vez instalado el contenedor podemos ejecutar el comando para ejecutar el comando que transforme nuestro `.md` a `.pdf`. En mi caso he instalado Docker en Windows 11 por lo que la estructura del comando que he usado es el siguiente:

```console
docker run --rm --volume "<carpeta donde est√°n los .md>:/data" pandoc/extra <entrada>.md -o <salida>.pdf --template eisvogel --listings
```

Ejemplo:

```console
docker run pandoc/extra
```

## De Markdown para Jekyll a documentos PDF

Con el siguiente comando y los siguientes ficheros de configuraci√≥n me genero este [PDF](/assets/img/pandoc/2024-03-01-tarea-xsl.pdf) a mi gusto:

Para PC fijo, creamos el contenedor de Docker:

```console
$docker run -d -it --volume "D:\GitHub\marcosruiz.github.io:/data" `
--volume "C:\Users\marco\MEGA\CURSO 23 24\Plantillas\Eisvogel:/root/.pandoc/templates" `
--name mruizg `
--restart=no --runtime=runc pandoc/extra
```

Para portatil, creamos el contenedor de Docker:

```console
$docker run -d -it --volume "C:\Users\marco\Documents\GitHub\marcosruiz.github.io:/data" `
--volume "C:\Users\marco\Documents\MEGA\CURSO 23 24\Plantillas\Eisvogel:/root/.pandoc/templates" `
--name mruizg `
--restart=no --runtime=runc pandoc/extra
```

Entramos en el contenedor de Docker:

```console
$docker exec -it b9c2ae80ad7723523c71d532a0e3901f26dd0c67bba7273e65965b6ef8cc3194 sh
```

Dentro del contenedor de docker ejecutamos:

```console
#apk update && apk add texlive-full
#tlmgr install svg
```

```powershell
# Para PC torre
$githubProjectFolder = "D:\GitHub\marcosruiz.github.io"
$templateFolder = "C:\Users\marco\MEGA\CURSO 23 24\Plantillas\Eisvogel"

# Para portatil
$githubProjectFolder = "C:\Users\marco\Documents\GitHub\marcosruiz.github.io"
$templateFolder = "C:\Users\marco\Documents\MEGA\CURSO 23 24\Plantillas\Eisvogel"

$routes = "css", "dtd", "espacios-de-nombres-xml", "html", "introduccion-lenguajes-marcas", "markdown", "practica-css-codepip", "practica-css-freecodecamp", "practica-css-w3schools", "practica-html", "practica-html-freecodecamp", "practica-html-w3schools", "representacion-informacion", "sindicacion-contenidos", "sistemas-gestion-empresarial", "tarea-calculadora-html-css", "tarea-dtd", "tarea-formato-svg", "tarea-introduccion-odoo", "tarea-introduccion-xpath", "tarea-introduccion-xml", "tarea-introduccion-xquery", "tarea-rss", "tarea-xsd", "tarea-xsl", "xml", "xpath", "xquery", "xsl", "xslfo", "xslt"

$routes = "sindicacion-contenidos"

# Iterar sobre cada patron de archivo
foreach ($route in $routes) {
  $pattern = "[0-9\-]{11}" + $route + "\.md"

  # Obtener el archivo correspondiente al patron
  $files = Get-ChildItem "$githubProjectFolder\_posts" | Where-Object { $_.Name -match $pattern }

  $file = $files[0]

  $resourcePath = "/data/assets/img/" + $route

  docker exec aaa230b91f7592b6f2e74372eccfc2038caf5c5ebc16865aea3d9ab11ef8923d pandoc "/data/_posts/$($file.Name)" `
    -o "/data/pdf/$($route).pdf" `
    --metadata-file /data/pandoc/metadata.yaml `
    --defaults /data/pandoc/defaults.yaml `
    --resource-path $resourcePath `
    --from markdown `
    --lua-filter /data/pandoc/filter.lua

}
```
{: file="exportarLmsgiAPdf.ps1" }

```yaml
listings: true
shift-heading-level-by: -1
number-sections: true
resource-path: ["/data/assets/img/tarea-xsl"]
template: "eisvogel2"
```
{: file="defaults.yaml" }

```yaml
author: [Marcos Ruiz Garc√≠a]
titlepage: true
toc-own-page: true
toc: true
lang: es-ES
```
{: file="metadata.yaml" }

En mi caso, a√±ado las siguientes clases CSS personalizadas:

- `section`
- `subsection`
- `subsubsection`
- `question`

Adem√°s por usar el [tema Chirpy](https://chirpy.cotes.page/) el cual usa las siguientes clases:

- `filepath`
- `prompt-tip`
- `prompt-info`
- `prompt-warning`
- `prompt-danger`
- `file` con la informaci√≥n del nombre del fichero.

Es por esto que necesito los siguientes filtros Lua:

```lua
-- Filtro para clase activity
function ParaActivity(el)
  -- Si el elemento es un p√°rrafo y contiene "{:.activity}", lo convertimos en un encabezado
  if el.tag == "Para" then
    local content = pandoc.utils.stringify(el)
    -- Si el p√°rrafo contiene "{:.activity}", lo convertimos en un encabezado de nivel 2
    if content:find("{:%.activity}") then
      -- Reemplazamos "{:.activity}" con una cadena vac√≠a
      content = content:gsub("{:%.activity} ###", "")
      -- Creamos un nuevo elemento de encabezado con el contenido modificado
      return pandoc.Header(2, content)
    end
    return el
  end
  -- Devolvemos el elemento sin cambios si no es un p√°rrafo
  return el
end

-- Filtro para clase section
function ParaSection(el)
  -- Si el elemento es un p√°rrafo y contiene "{:.section}", lo convertimos en un encabezado
  if el.tag == "Para" then
    local content = pandoc.utils.stringify(el)
    -- Si el p√°rrafo contiene "{:.section}", lo convertimos en un encabezado de nivel 2
    if content:find("{:%.section}") then
      -- Reemplazamos "{:.section}" con una cadena vac√≠a
      content = content:gsub("{:%.section} ##", "")
      -- Creamos un nuevo elemento de encabezado con el contenido modificado
      return pandoc.Header(1, content)
    end
    return el
  end
  -- Devolvemos el elemento sin cambios si no es un p√°rrafo
  return el
end

-- Filtro para clase subsection
function ParaSubsection(el)
  -- Si el elemento es un p√°rrafo y contiene "{:.subsection}", lo convertimos en un encabezado
  if el.tag == "Para" then
    local content = pandoc.utils.stringify(el)
    -- Si el p√°rrafo contiene "{:.subsection}", lo convertimos en un encabezado de nivel 2
    if content:find("{:%.subsection}") then
      -- Reemplazamos "{:.subsection}" con una cadena vac√≠a
      content = content:gsub("{:%.subsection} ###", "")
      -- Creamos un nuevo elemento de encabezado con el contenido modificado
      return pandoc.Header(2, content)
    end
    return el
  end
  -- Devolvemos el elemento sin cambios si no es un p√°rrafo
  return el
end

-- Filtro para clase subsubsection
function ParaSubsubsection(el)
  -- Si el elemento es un p√°rrafo y contiene "{:.subsubsection}", lo convertimos en un encabezado
  if el.tag == "Para" then
    local content = pandoc.utils.stringify(el)
    -- Si el p√°rrafo contiene "{:.subsubsection}", lo convertimos en un encabezado de nivel 2
    if content:find("{:%.subsubsection}") then
      -- Reemplazamos "{:.subsubsection}" con una cadena vac√≠a
      content = content:gsub("{:%.subsubsection} ####", "")
      -- Creamos un nuevo elemento de encabezado con el contenido modificado
      return pandoc.Header(3, content)
    end
    return el
  end
  -- Devolvemos el elemento sin cambios si no es un p√°rrafo
  return el
end

-- Filtro para clase prompt-info, prompt-tip, prompt-warning, prompt-danger
function RemovePrompts(el)
  -- Si el elemento es un p√°rrafo y contiene "{:.prompt-.*}", lo convertimos en un encabezado
  if el.tag == "Para" then
    local content = pandoc.utils.stringify(el)
    -- Si el p√°rrafo contiene "{:.prompt-.*}", lo convertimos en un encabezado de nivel 2
    if content:find("{:%s?%.prompt%-.+}") then
      -- Reemplazamos "{:.prompt-.*}" con una cadena vac√≠a
      content = content:gsub("{:%s?%.prompt%-.+}", "")
      -- Creamos un nuevo elemento de encabezado con el contenido modificado
      return pandoc.Para(content)
    end
    return el
  end
  -- Devolvemos el elemento sin cambios si no es un p√°rrafo
  return el
end

-- Filtro para clase filepath
function RemoveFilepaths(el)
  -- Si el elemento es un p√°rrafo y contiene "{:.filepath}", lo convertimos en un encabezado
  if el.tag == "Para" then
    local content = pandoc.utils.stringify(el)
    -- Si el p√°rrafo contiene "{:.filepath}", lo convertimos en un encabezado de nivel 2
    if content:find("{:%s?%.filepath}") then
      -- Reemplazamos "{:.filepath}" con una cadena vac√≠a
      content = content:gsub("{:%s?%.filepath}", "")
      -- Creamos un nuevo elemento de encabezado con el contenido modificado
      return pandoc.Para(content)
    end
    return el
  end
  -- Devolvemos el elemento sin cambios si no es un p√°rrafo
  return el
end

-- Filtro para los nombres de los ficheros
function ExtractFilePath(el)
  -- Si el elemento es un p√°rrafo
  if el.tag == "Para" then
    local content = pandoc.utils.stringify(el)
    -- Buscamos los p√°rrafos que empiezan por "{: file=\"" y terminan con "\" }"
    local filepath = content:match("{:%s?file=‚Äú(.-)‚Äù%s?}")
    -- Si encontramos un filepath, devolvemos un nuevo p√°rrafo con el filepath como contenido
    if filepath then
      return pandoc.Para("Fichero: " .. filepath)
    end
  end
  -- Devolvemos el elemento sin cambios si no es un p√°rrafo que cumple con el patr√≥n
  return el
end

function removeEmojis(el)
  if el.tag == "Str" then
    local content = pandoc.utils.stringify(el)
    local palabras = {"ü•≥", "üì∏", "üëè", "üòÆ", "üî•", "üîù", "üôå", "üëå", "Âèñ", "Âæó", "êêù"}
    -- Recorrer la array
    for i, palabra in ipairs(palabras) do
      content = content:gsub(palabra, "")
    end
    return pandoc.Str(content)
  end
  return el
end

function removeCyrilic(el)
  if el.tag == "Str" then
    local content = pandoc.utils.stringify(el)
    local patron = "[–¥–ñ]"
    content = content:gsub(patron, "")
    return pandoc.Str(content)
  end
  return el
end

return {
  {Para = ParaActivity},
  {Para = ParaSection},
  {Para = ParaSubsection},
  {Para = ParaSubsubsection},
  {Para = RemovePrompts},
  {Para = RemoveFilepaths},
  {Para = ExtractFilePath},
  {Str = removeEmojis},
  {Str = removeCyrilic}
}
```
{: file="filter.lua" }

## De documentos Markdown para Notion a documentos PDF

Con Markdown ser√≠a mucho m√°s sencillo de generar:

```console
$githubProjectFolder = "C:\Users\marco\Documents\GitHub\marcosruiz.github.io"
$templatesFolder = "C:\Users\marco\Documents\MEGA\CURSO 23 24\Plantillas\Eisvogel"
docker run --rm --volume "$githubProjectFolder:/data" `
--volume "%templatesFolder:/root/.pandoc/templates" `
pandoc/extra /data/_posts/2024-03-01-tarea-xsl.md -o /data/pdf/2024-03-01-tarea-xsl.pdf `
--metadata-file /data/pandoc/metadata.yaml `
--defaults /data/pandoc/defaults.yaml
```

```yaml
listings: true
number-sections: true
template: "eisvogel2"
```
{: file="defaults.yaml" }

```yaml
author: [Marcos Ruiz Garc√≠a]
titlepage: true
toc-own-page: true
toc: true
lang: es-ES
```
{: file="metadata.yaml" }

## De Docx a Markdown

Una de las ventajas que tiene Markdown sobre DOCX es que se puede leer desde cualquier dispositivo c√≥modamente.

```powershell
docker run --rm --volume "<carpeta donde esta el Docx>\:/data" `
pandoc/extra --extract-media='./' `
"/data/<nombre del docx>.docx" `
-o "/data/<nombre del md de salida>.md"
```

Ejemplo de uso:

```powershell
$temasPropiosFolder = "C:\Users\marco\MEGA\OPOS\SAI\SAI Temas\00 SAI Temas propios\"
$creator = "mruizg"

$numbers = @("01", "02", "03", "04", "05", "06", "07", "08", "10", "52", "53", "54", "55", "56", "57", "58", "59", "60", "61", "62", "63", "64", "65")

$titles = @(
  "Representaci√≥n y comunicaci√≥n de la informaci√≥n", 
  "Elementos funcionales de un ordenador digital", 
  "Componentes, estructura y funcionamiento de la Unidad Central de Proceso", 
  "Memoria interna. Tipos. Direccionamiento. Caracter√≠sticas y funciones", 
  "Microprocesadores. Estructura. Tipos. Comunicaci√≥n con el exterior", 
  "Sistemas de almacenamiento externo. Tipos. Caracter√≠sticas y funcionamiento", 
  "Dispositivos perif√©ricos de entradasalida. Caracter√≠sticas y funcionamiento", 
  "Hardware comercial de un ordenador. Placa base. Tarjetas controladoras de dispositivos y de entradasalida", 
  "Representaci√≥n interna de los datos", 
  "Sistemas en red. Tipos. Componentes y topolog√≠as", 
  "Transmisi√≥n de datos. Medios. Tipos. T√©cnicas. Perturbaciones", 
  "Arquitectura de sistemas de comunicaci√≥n. Niveles. Funciones. Servicios", 
  "Conexi√≥n de ordenadores en red. Elementos hardware necesarios. Tipos y caracter√≠sticas", 
  "Software de sistemas en red. Componentes. Funciones y estructura", 
  "Redes de √°rea local. Hardware. Software. Recursos compartidos", 
  "Redes de √°rea extensa. Interconexi√≥n redes locales", 
  "An√°lisis e implantaci√≥n de un sistema en red", 
  "Instalaci√≥n y configuraci√≥n de sistemas en red local", 
  "Integraci√≥n de sistemas. Medios de interconexi√≥n est√°ndares", 
  "Evaluaci√≥n y mejora del rendimiento de sistemas en red", 
  "Seguridad de los sistemas en red", 
  "Explotaci√≥n y administraci√≥n de sistemas en red", 
  "An√°lisis comparativo entre un sistema operativo multiusuario y un sistema en red"
)

for ($i = 0; $i -lt $titles.Count; $i++) {
  $number = $numbers[$i]
  $title = $titles[$i]
  $folder = "$number-$title"
  $file = "$number-$creator-$title"

  $volumePath = $temasPropiosFolder + $folder
  $dockerVolume = '"' + $volumePath + ':/data"'

  docker run --rm --volume $dockerVolume `
    pandoc/extra --extract-media='./' `
    "/data/$file.docx" `
    --wrap=none `
    -o "/data/$file.md"
}
```
{: file="docxToMd.ps1" }

> Si copias este texto en un fichero `.ps1` deber√° ser en codificaci√≥n Windows 1252.
{:.prompt-warning}

## Alternativas a Jekyll

Actualmente estoy usando para esta web [Jekyll](https://jekyllrb.com/) con el [tema Chirpy](https://github.com/cotes2020/jekyll-theme-chirpy) pero existen alternativas:

- [MkDocs](https://www.mkdocs.org/) con [Material for MkDocs](https://squidfunk.github.io/mkdocs-material/)
- [VuePress](https://vuepress.vuejs.org/) con [VuePress Theme Hope](https://theme-hope.vuejs.press/)

## Bibliograf√≠a

- <https://github.com/Wandmalfarbe/pandoc-latex-template?tab=readme-ov-file>
- <https://github.com/ryangrose/easy-pandoc-templates>
- <https://pandoc.org/lua-filters.html>
