---
title: "Tutorial: Instalar y configurar servidor DNS Bind9 para servidor de correo"
date: 2022-02-13 16:50:00 +0100
categories: [Sistemas Microinformáticos y Redes, Servicios en Red]
tags: [packet tracer, servicios en red, smr, tutorial]
---
## Introducción

Para la instalación del servidor DNS Bind9 se han seguido los pasos indicados en el siguiente vídeo:

<iframe width="100%" height="315" src="https://www.youtube.com/embed/hq8kWcpGUvw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

## Configuración

![img-description](/assets/img/tutorial-configurar-dns-bind9/configuracionRedServidor.png)
_Configuración de red servidor DNS_

Instalar programas necesarios:

```console
$ sudo -i
# apt update
# apt install bind9
# apt install resolvconf
```

Ejecutamos la siguiente instrucción para tener permisos de administrador.

```console
# service network-manager restart
# ifconfig
# ping google.es
# ifconfig
# service bind9 status
```

Comprobamos que el fichero resolv.conf está bien, sino reiniciamos la máquina:

```shell
# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
# 127.0.0.53 is the systemd-resolved stub resolver.
# run "systemd-resolve --status" to see details about the actual nameservers.

nameserver 192.168.222.2
nameserver 127.0.0.53
search mruizg.es
```
{: file="/etc/resolv.conf" }

Modificamos esta línea del fichero nsswitch.conf:

```shell
hosts:          files mdns4_minimal [NOTFOUND=return] dns
```
{: file="/etc/nsswitch.conf" }

Por esta:

```shell
hosts:          dns files mdns4_minimal [NOTFOUND=return]
```
{: file="/etc/nsswitch.conf" }

En named.conf.local añadimos lo siguiente:

```shell
// zona directa para el dominio mruizg.es
zone "mruizg.es" {
  type master;
  file "/etc/bind/db.mruizg.es";
};
// zona inversa para la red 192.168.222.0
zone "222.168.192.in-addr.arpa" {
  type master;
  file "/etc/bind/db.222.168.192";
};
```
{: file="/etc/bind/named.conf.local" }


```shell
;
; BIND data file for mruizg.es zone
;
$TTL    604800
@       IN      SOA     servidor.mruizg.es. root.mruizg.es. (
                              2         ; Serial
                         604800         ; Refresh
                          86400         ; Retry
                        2419200         ; Expire
                         604800 )       ; Negative Cache TTL
;
;
                       IN    NS      servidor.mruizg.es.
servidor               IN    A    192.168.222.2
cliente1               IN    A    192.168.222.51
router                 IN    A    192.168.222.1
cliente2.mruizg.es.   IN    A    192.168.222.52
server                 IN    CNAME    servidor
correo                 IN    A        192.168.222.2
mruizg.es              IN    MX 10    correo
```
{: file="/etc/bind/db.mruizg.es" }



```shell
;
; BIND data file for mruizg.es zone
;
$TTL    604800
@       IN      SOA     servidor.mruizg.es. root.mruizg.es. (
                              2         ; Serial
                         604800         ; Refresh
                          86400         ; Retry
                        2419200         ; Expire
                         604800 )       ; Negative Cache TTL
;
;
      IN    NS     servidor.mruizg.es.
2     IN    PTR    servidor.mruizg.es.
51    IN    PTR    cliente1.mruizg.es.
1     IN    PTR    router.mruizg.es.
52    IN    PTR    cliente2.mruizg.es.
```
{: file="/etc/bind/db.222.168.192" }

Comprobamos la sintaxis con los siguientes comandos:

```console
# named-checkconf /etc/bind/named.conf.local
# named-checkzone mruiz.org /etc/bind/db.mruizg.org
# named-checkzone 222.168.192.in-addr.arpa /etc/bind/db.222.168.192
# service bind9 restart
# service bind9 status
```

Comprobamos que funciona:

```console
# ping -c 4 192.168.222.2
# ping -c 4 servidor
# ping -c 4 servidor.mruizg.org
# host servidor
# host server
# nslookup servidor
# nslookup server
# nslookup 192.168.222.2
# nslookup 192.168.222.51
# nslookup google.es
# dig cliente1.mruizg.org
# dig cliente1.mruizg.org +noall +comments +answer
# dig -x 192.168.222.51
```

El servicio rndc es el que se encarga de la caché. Con la siguiente instrucción limpiamos dicha cache:

```console
# rndc flush
# dig google.es +noall +stats
# dig google.es +noall +stats
# dig cliente1 +noall +stats
```
